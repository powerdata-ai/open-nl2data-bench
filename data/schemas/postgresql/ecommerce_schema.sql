-- PostgreSQL Schema for OpenNL2Data-Bench

-- Scenario: ecommerce

-- Generated by SchemaGenerator



-- Connection settings

SET client_encoding = 'UTF8';

SET standard_conforming_strings = on;

SET check_function_bodies = false;

SET xmloption = content;

SET client_min_messages = warning;

SET row_security = off;



-- Create schema if not exists

CREATE SCHEMA IF NOT EXISTS ecommerce;

SET search_path TO ecommerce, public;



CREATE TABLE afs_knowledge (
	knowledge_id BIGSERIAL NOT NULL, 
	category_id BIGINT NOT NULL, 
	category_name VARCHAR(100) NOT NULL, 
	question VARCHAR(500) NOT NULL, 
	answer TEXT NOT NULL, 
	keywords VARCHAR(500), 
	applicable_scenario VARCHAR(200), 
	knowledge_status SMALLINT NOT NULL, 
	view_count BIGINT NOT NULL, 
	helpful_count BIGINT NOT NULL, 
	unhelpful_count BIGINT NOT NULL, 
	priority SMALLINT NOT NULL, 
	sort_order SMALLINT NOT NULL, 
	author_id BIGINT NOT NULL, 
	last_modifier_id BIGINT, 
	created_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	is_deleted SMALLINT NOT NULL, 
	CONSTRAINT pk_afs_knowledge PRIMARY KEY (knowledge_id)
);

CREATE TABLE log_logistics_company (
	company_id BIGSERIAL NOT NULL, 
	company_code VARCHAR(50) NOT NULL, 
	company_name VARCHAR(100) NOT NULL, 
	api_url VARCHAR(200), 
	api_key VARCHAR(100), 
	service_type SMALLINT NOT NULL, 
	coverage_area TEXT, 
	base_fee NUMERIC(10, 2) NOT NULL, 
	additional_fee NUMERIC(10, 2) NOT NULL, 
	company_status SMALLINT NOT NULL, 
	sort_order SMALLINT NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	is_deleted SMALLINT NOT NULL, 
	CONSTRAINT pk_log_logistics_company PRIMARY KEY (company_id), 
	CONSTRAINT uq_log_logistics_company_company_code UNIQUE (company_code)
);

CREATE TABLE log_shipping_template (
	template_id BIGSERIAL NOT NULL, 
	template_name VARCHAR(100) NOT NULL, 
	template_type SMALLINT NOT NULL, 
	default_first_unit BIGINT NOT NULL, 
	default_first_fee NUMERIC(10, 2) NOT NULL, 
	default_additional_unit BIGINT NOT NULL, 
	default_additional_fee NUMERIC(10, 2) NOT NULL, 
	free_shipping_type SMALLINT NOT NULL, 
	free_shipping_amount NUMERIC(10, 2) NOT NULL, 
	free_shipping_count BIGINT NOT NULL, 
	template_status SMALLINT NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	is_deleted SMALLINT NOT NULL, 
	CONSTRAINT pk_log_shipping_template PRIMARY KEY (template_id)
);

CREATE TABLE log_warehouse (
	warehouse_id BIGSERIAL NOT NULL, 
	warehouse_code VARCHAR(50) NOT NULL, 
	warehouse_name VARCHAR(100) NOT NULL, 
	warehouse_type SMALLINT NOT NULL, 
	province VARCHAR(50) NOT NULL, 
	city VARCHAR(50) NOT NULL, 
	district VARCHAR(50) NOT NULL, 
	address VARCHAR(200) NOT NULL, 
	contact_name VARCHAR(50) NOT NULL, 
	contact_phone VARCHAR(20) NOT NULL, 
	warehouse_status SMALLINT NOT NULL, 
	total_area NUMERIC(10, 2), 
	usable_area NUMERIC(10, 2), 
	created_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	is_deleted SMALLINT NOT NULL, 
	CONSTRAINT pk_log_warehouse PRIMARY KEY (warehouse_id), 
	CONSTRAINT uq_log_warehouse_warehouse_code UNIQUE (warehouse_code)
);

CREATE TABLE ord_order_main (
	order_id BIGSERIAL NOT NULL, 
	order_no VARCHAR(32) NOT NULL, 
	user_id BIGINT NOT NULL, 
	parent_order_id BIGINT, 
	total_amount NUMERIC(12, 2) NOT NULL, 
	discount_amount NUMERIC(12, 2) NOT NULL, 
	shipping_fee NUMERIC(10, 2) NOT NULL, 
	actual_amount NUMERIC(12, 2) NOT NULL, 
	order_status SMALLINT NOT NULL, 
	payment_status SMALLINT NOT NULL, 
	shipping_status SMALLINT NOT NULL, 
	refund_status SMALLINT NOT NULL, 
	promotion_id BIGINT, 
	coupon_id BIGINT, 
	shipping_address_id BIGINT NOT NULL, 
	order_time TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	payment_time TIMESTAMP WITHOUT TIME ZONE, 
	shipping_time TIMESTAMP WITHOUT TIME ZONE, 
	complete_time TIMESTAMP WITHOUT TIME ZONE, 
	cancel_time TIMESTAMP WITHOUT TIME ZONE, 
	order_source SMALLINT NOT NULL, 
	buyer_message VARCHAR(500), 
	created_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	is_deleted SMALLINT NOT NULL, 
	CONSTRAINT pk_ord_order_main PRIMARY KEY (order_id), 
	CONSTRAINT uq_ord_order_main_order_no UNIQUE (order_no)
);

CREATE TABLE pay_account_balance (
	account_id BIGSERIAL NOT NULL, 
	user_id BIGINT NOT NULL, 
	balance NUMERIC(12, 2) NOT NULL, 
	frozen_balance NUMERIC(12, 2) NOT NULL, 
	total_recharge NUMERIC(12, 2) NOT NULL, 
	total_consume NUMERIC(12, 2) NOT NULL, 
	total_withdraw NUMERIC(12, 2) NOT NULL, 
	account_status SMALLINT NOT NULL, 
	version BIGINT NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	CONSTRAINT pk_pay_account_balance PRIMARY KEY (account_id), 
	CONSTRAINT uq_pay_account_balance_user_id UNIQUE (user_id)
);

CREATE TABLE pay_payment_channel (
	channel_id BIGSERIAL NOT NULL, 
	channel_code VARCHAR(50) NOT NULL, 
	channel_name VARCHAR(100) NOT NULL, 
	channel_type SMALLINT NOT NULL, 
	app_id VARCHAR(100), 
	merchant_id VARCHAR(100), 
	api_config TEXT, 
	fee_rate NUMERIC(5, 4) NOT NULL, 
	min_fee NUMERIC(10, 2) NOT NULL, 
	max_fee NUMERIC(10, 2) NOT NULL, 
	min_amount NUMERIC(10, 2) NOT NULL, 
	max_amount NUMERIC(10, 2) NOT NULL, 
	channel_status SMALLINT NOT NULL, 
	sort_order SMALLINT NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	is_deleted SMALLINT NOT NULL, 
	CONSTRAINT pk_pay_payment_channel PRIMARY KEY (channel_id), 
	CONSTRAINT uq_pay_payment_channel_channel_code UNIQUE (channel_code)
);

CREATE TABLE log_delivery_route (
	route_id BIGSERIAL NOT NULL, 
	route_no VARCHAR(32) NOT NULL, 
	courier_id BIGINT NOT NULL, 
	courier_name VARCHAR(50) NOT NULL, 
	courier_phone VARCHAR(20) NOT NULL, 
	delivery_date TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	warehouse_id BIGINT NOT NULL, 
	route_status SMALLINT NOT NULL, 
	total_orders SMALLINT NOT NULL, 
	completed_orders SMALLINT NOT NULL, 
	start_time TIMESTAMP WITHOUT TIME ZONE, 
	end_time TIMESTAMP WITHOUT TIME ZONE, 
	created_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	CONSTRAINT pk_log_delivery_route PRIMARY KEY (route_id), 
	CONSTRAINT uq_log_delivery_route_route_no UNIQUE (route_no), 
	CONSTRAINT fk_log_delivery_route_warehouse_id_log_warehouse FOREIGN KEY(warehouse_id) REFERENCES log_warehouse (warehouse_id)
);

CREATE TABLE log_inventory (
	inventory_id BIGSERIAL NOT NULL, 
	warehouse_id BIGINT NOT NULL, 
	sku_id BIGINT NOT NULL, 
	available_stock BIGINT NOT NULL, 
	frozen_stock BIGINT NOT NULL, 
	in_transit_stock BIGINT NOT NULL, 
	safety_stock BIGINT NOT NULL, 
	version BIGINT NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	CONSTRAINT pk_log_inventory PRIMARY KEY (inventory_id), 
	CONSTRAINT fk_log_inventory_warehouse_id_log_warehouse FOREIGN KEY(warehouse_id) REFERENCES log_warehouse (warehouse_id)
);

CREATE TABLE log_shipping_order (
	shipping_id BIGSERIAL NOT NULL, 
	shipping_no VARCHAR(32) NOT NULL, 
	order_id BIGINT NOT NULL, 
	warehouse_id BIGINT NOT NULL, 
	logistics_company_id BIGINT NOT NULL, 
	tracking_no VARCHAR(50) NOT NULL, 
	receiver_name VARCHAR(50) NOT NULL, 
	receiver_phone VARCHAR(20) NOT NULL, 
	receiver_province VARCHAR(50) NOT NULL, 
	receiver_city VARCHAR(50) NOT NULL, 
	receiver_district VARCHAR(50) NOT NULL, 
	receiver_address VARCHAR(500) NOT NULL, 
	shipping_status SMALLINT NOT NULL, 
	ship_time TIMESTAMP WITHOUT TIME ZONE, 
	delivery_time TIMESTAMP WITHOUT TIME ZONE, 
	shipping_remark VARCHAR(500), 
	created_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	CONSTRAINT pk_log_shipping_order PRIMARY KEY (shipping_id), 
	CONSTRAINT uq_log_shipping_order_shipping_no UNIQUE (shipping_no), 
	CONSTRAINT fk_log_shipping_order_order_id_ord_order_main FOREIGN KEY(order_id) REFERENCES ord_order_main (order_id), 
	CONSTRAINT fk_log_shipping_order_warehouse_id_log_warehouse FOREIGN KEY(warehouse_id) REFERENCES log_warehouse (warehouse_id), 
	CONSTRAINT fk_log_shipping_order_logistics_company_id_log_logistic_2754 FOREIGN KEY(logistics_company_id) REFERENCES log_logistics_company (company_id)
);

CREATE TABLE ord_invoice_request (
	request_id BIGSERIAL NOT NULL, 
	order_id BIGINT NOT NULL, 
	user_id BIGINT NOT NULL, 
	invoice_type SMALLINT NOT NULL, 
	invoice_title_type SMALLINT NOT NULL, 
	invoice_title VARCHAR(200) NOT NULL, 
	tax_no VARCHAR(50), 
	company_address VARCHAR(200), 
	company_phone VARCHAR(20), 
	bank_name VARCHAR(100), 
	bank_account VARCHAR(50), 
	invoice_amount NUMERIC(12, 2) NOT NULL, 
	request_status SMALLINT NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	CONSTRAINT pk_ord_invoice_request PRIMARY KEY (request_id), 
	CONSTRAINT fk_ord_invoice_request_order_id_ord_order_main FOREIGN KEY(order_id) REFERENCES ord_order_main (order_id)
);

CREATE TABLE ord_order_cancel_log (
	cancel_id BIGSERIAL NOT NULL, 
	order_id BIGINT NOT NULL, 
	cancel_reason_type SMALLINT NOT NULL, 
	cancel_reason VARCHAR(500) NOT NULL, 
	operator_id BIGINT NOT NULL, 
	operator_type SMALLINT NOT NULL, 
	cancel_time TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	CONSTRAINT pk_ord_order_cancel_log PRIMARY KEY (cancel_id), 
	CONSTRAINT fk_ord_order_cancel_log_order_id_ord_order_main FOREIGN KEY(order_id) REFERENCES ord_order_main (order_id)
);

CREATE TABLE ord_order_delivery (
	delivery_id BIGSERIAL NOT NULL, 
	order_id BIGINT NOT NULL, 
	logistics_company VARCHAR(100) NOT NULL, 
	tracking_no VARCHAR(50) NOT NULL, 
	delivery_status SMALLINT NOT NULL, 
	ship_time TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	receive_time TIMESTAMP WITHOUT TIME ZONE, 
	receiver_name VARCHAR(50) NOT NULL, 
	receiver_phone VARCHAR(20) NOT NULL, 
	receiver_address VARCHAR(500) NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	CONSTRAINT pk_ord_order_delivery PRIMARY KEY (delivery_id), 
	CONSTRAINT fk_ord_order_delivery_order_id_ord_order_main FOREIGN KEY(order_id) REFERENCES ord_order_main (order_id)
);

CREATE TABLE ord_order_evaluation (
	evaluation_id BIGSERIAL NOT NULL, 
	order_id BIGINT NOT NULL, 
	user_id BIGINT NOT NULL, 
	product_score SMALLINT NOT NULL, 
	service_score SMALLINT NOT NULL, 
	logistics_score SMALLINT NOT NULL, 
	evaluation_content TEXT, 
	evaluation_images TEXT, 
	evaluation_status SMALLINT NOT NULL, 
	is_anonymous SMALLINT NOT NULL, 
	append_content TEXT, 
	append_time TIMESTAMP WITHOUT TIME ZONE, 
	created_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	CONSTRAINT pk_ord_order_evaluation PRIMARY KEY (evaluation_id), 
	CONSTRAINT fk_ord_order_evaluation_order_id_ord_order_main FOREIGN KEY(order_id) REFERENCES ord_order_main (order_id)
);

CREATE TABLE ord_order_item (
	item_id BIGSERIAL NOT NULL, 
	order_id BIGINT NOT NULL, 
	product_id BIGINT NOT NULL, 
	sku_id BIGINT NOT NULL, 
	product_name VARCHAR(200) NOT NULL, 
	sku_name VARCHAR(200) NOT NULL, 
	sku_attrs TEXT, 
	product_image VARCHAR(500) NOT NULL, 
	original_price NUMERIC(10, 2) NOT NULL, 
	unit_price NUMERIC(10, 2) NOT NULL, 
	quantity SMALLINT NOT NULL, 
	discount_amount NUMERIC(10, 2) NOT NULL, 
	actual_amount NUMERIC(10, 2) NOT NULL, 
	refund_quantity SMALLINT NOT NULL, 
	refund_amount NUMERIC(10, 2) NOT NULL, 
	item_status SMALLINT NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	CONSTRAINT pk_ord_order_item PRIMARY KEY (item_id), 
	CONSTRAINT fk_ord_order_item_order_id_ord_order_main FOREIGN KEY(order_id) REFERENCES ord_order_main (order_id)
);

CREATE TABLE ord_order_log (
	log_id BIGSERIAL NOT NULL, 
	order_id BIGINT NOT NULL, 
	operation_type SMALLINT NOT NULL, 
	operation_desc VARCHAR(500) NOT NULL, 
	old_status SMALLINT, 
	new_status SMALLINT, 
	operator_id BIGINT, 
	operator_type SMALLINT NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	CONSTRAINT pk_ord_order_log PRIMARY KEY (log_id), 
	CONSTRAINT fk_ord_order_log_order_id_ord_order_main FOREIGN KEY(order_id) REFERENCES ord_order_main (order_id)
);

CREATE TABLE ord_order_payment (
	payment_id BIGSERIAL NOT NULL, 
	order_id BIGINT NOT NULL, 
	payment_no VARCHAR(32) NOT NULL, 
	payment_method SMALLINT NOT NULL, 
	payment_amount NUMERIC(12, 2) NOT NULL, 
	trade_no VARCHAR(64), 
	payment_channel VARCHAR(50), 
	payment_status SMALLINT NOT NULL, 
	payment_time TIMESTAMP WITHOUT TIME ZONE, 
	remark VARCHAR(500), 
	created_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	CONSTRAINT pk_ord_order_payment PRIMARY KEY (payment_id), 
	CONSTRAINT fk_ord_order_payment_order_id_ord_order_main FOREIGN KEY(order_id) REFERENCES ord_order_main (order_id), 
	CONSTRAINT uq_ord_order_payment_payment_no UNIQUE (payment_no)
);

CREATE TABLE ord_order_promotion (
	id BIGSERIAL NOT NULL, 
	order_id BIGINT NOT NULL, 
	promotion_id BIGINT NOT NULL, 
	promotion_type SMALLINT NOT NULL, 
	promotion_name VARCHAR(100) NOT NULL, 
	discount_amount NUMERIC(10, 2) NOT NULL, 
	rule_desc VARCHAR(500), 
	created_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	CONSTRAINT pk_ord_order_promotion PRIMARY KEY (id), 
	CONSTRAINT fk_ord_order_promotion_order_id_ord_order_main FOREIGN KEY(order_id) REFERENCES ord_order_main (order_id)
);

CREATE TABLE ord_order_split (
	split_id BIGSERIAL NOT NULL, 
	parent_order_id BIGINT NOT NULL, 
	child_order_id BIGINT NOT NULL, 
	split_reason SMALLINT NOT NULL, 
	split_desc VARCHAR(500), 
	created_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	CONSTRAINT pk_ord_order_split PRIMARY KEY (split_id), 
	CONSTRAINT fk_ord_order_split_parent_order_id_ord_order_main FOREIGN KEY(parent_order_id) REFERENCES ord_order_main (order_id), 
	CONSTRAINT fk_ord_order_split_child_order_id_ord_order_main FOREIGN KEY(child_order_id) REFERENCES ord_order_main (order_id)
);

CREATE TABLE pay_balance_log (
	log_id BIGSERIAL NOT NULL, 
	account_id BIGINT NOT NULL, 
	user_id BIGINT NOT NULL, 
	business_no VARCHAR(32) NOT NULL, 
	business_type SMALLINT NOT NULL, 
	change_type SMALLINT NOT NULL, 
	change_amount NUMERIC(12, 2) NOT NULL, 
	before_balance NUMERIC(12, 2) NOT NULL, 
	after_balance NUMERIC(12, 2) NOT NULL, 
	change_desc VARCHAR(500), 
	created_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	CONSTRAINT pk_pay_balance_log PRIMARY KEY (log_id), 
	CONSTRAINT fk_pay_balance_log_account_id_pay_account_balance FOREIGN KEY(account_id) REFERENCES pay_account_balance (account_id)
);

CREATE TABLE pay_payment_order (
	payment_id BIGSERIAL NOT NULL, 
	payment_no VARCHAR(32) NOT NULL, 
	business_no VARCHAR(32) NOT NULL, 
	business_type SMALLINT NOT NULL, 
	user_id BIGINT NOT NULL, 
	payment_amount NUMERIC(12, 2) NOT NULL, 
	actual_amount NUMERIC(12, 2) NOT NULL, 
	fee_amount NUMERIC(10, 2) NOT NULL, 
	channel_id BIGINT NOT NULL, 
	channel_code VARCHAR(50) NOT NULL, 
	payment_method SMALLINT NOT NULL, 
	trade_no VARCHAR(64), 
	payment_status SMALLINT NOT NULL, 
	request_time TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	payment_time TIMESTAMP WITHOUT TIME ZONE, 
	close_time TIMESTAMP WITHOUT TIME ZONE, 
	expire_time TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	client_ip VARCHAR(50), 
	device_info VARCHAR(200), 
	remark VARCHAR(500), 
	created_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	CONSTRAINT pk_pay_payment_order PRIMARY KEY (payment_id), 
	CONSTRAINT uq_pay_payment_order_payment_no UNIQUE (payment_no), 
	CONSTRAINT fk_pay_payment_order_channel_id_pay_payment_channel FOREIGN KEY(channel_id) REFERENCES pay_payment_channel (channel_id)
);

CREATE TABLE pay_settlement_record (
	settlement_id BIGSERIAL NOT NULL, 
	settlement_no VARCHAR(32) NOT NULL, 
	channel_id BIGINT NOT NULL, 
	settlement_cycle SMALLINT NOT NULL, 
	settlement_date TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	start_time TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	end_time TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	total_amount NUMERIC(12, 2) NOT NULL, 
	total_fee NUMERIC(12, 2) NOT NULL, 
	settlement_amount NUMERIC(12, 2) NOT NULL, 
	total_count BIGINT NOT NULL, 
	success_count BIGINT NOT NULL, 
	refund_count BIGINT NOT NULL, 
	settlement_status SMALLINT NOT NULL, 
	bank_name VARCHAR(100), 
	bank_account VARCHAR(50), 
	remark VARCHAR(500), 
	created_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	CONSTRAINT pk_pay_settlement_record PRIMARY KEY (settlement_id), 
	CONSTRAINT uq_pay_settlement_record_settlement_no UNIQUE (settlement_no), 
	CONSTRAINT fk_pay_settlement_record_channel_id_pay_payment_channel FOREIGN KEY(channel_id) REFERENCES pay_payment_channel (channel_id)
);

CREATE TABLE log_package_info (
	package_id BIGSERIAL NOT NULL, 
	package_no VARCHAR(32) NOT NULL, 
	shipping_id BIGINT NOT NULL, 
	package_weight NUMERIC(10, 3) NOT NULL, 
	package_length NUMERIC(10, 2) NOT NULL, 
	package_width NUMERIC(10, 2) NOT NULL, 
	package_height NUMERIC(10, 2) NOT NULL, 
	package_volume NUMERIC(10, 3) NOT NULL, 
	package_type SMALLINT NOT NULL, 
	packer_id BIGINT, 
	pack_time TIMESTAMP WITHOUT TIME ZONE, 
	package_remark VARCHAR(500), 
	created_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	CONSTRAINT pk_log_package_info PRIMARY KEY (package_id), 
	CONSTRAINT uq_log_package_info_package_no UNIQUE (package_no), 
	CONSTRAINT fk_log_package_info_shipping_id_log_shipping_order FOREIGN KEY(shipping_id) REFERENCES log_shipping_order (shipping_id)
);

CREATE TABLE log_shipping_item (
	item_id BIGSERIAL NOT NULL, 
	shipping_id BIGINT NOT NULL, 
	order_item_id BIGINT NOT NULL, 
	sku_id BIGINT NOT NULL, 
	product_name VARCHAR(200) NOT NULL, 
	sku_name VARCHAR(200) NOT NULL, 
	shipping_quantity SMALLINT NOT NULL, 
	received_quantity SMALLINT NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	CONSTRAINT pk_log_shipping_item PRIMARY KEY (item_id), 
	CONSTRAINT fk_log_shipping_item_shipping_id_log_shipping_order FOREIGN KEY(shipping_id) REFERENCES log_shipping_order (shipping_id), 
	CONSTRAINT fk_log_shipping_item_order_item_id_ord_order_item FOREIGN KEY(order_item_id) REFERENCES ord_order_item (item_id)
);

CREATE TABLE log_tracking_info (
	tracking_id BIGSERIAL NOT NULL, 
	shipping_id BIGINT NOT NULL, 
	tracking_status SMALLINT NOT NULL, 
	tracking_location VARCHAR(200) NOT NULL, 
	tracking_desc VARCHAR(500) NOT NULL, 
	tracking_time TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	operator VARCHAR(50), 
	created_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	CONSTRAINT pk_log_tracking_info PRIMARY KEY (tracking_id), 
	CONSTRAINT fk_log_tracking_info_shipping_id_log_shipping_order FOREIGN KEY(shipping_id) REFERENCES log_shipping_order (shipping_id)
);

CREATE TABLE ord_order_invoice (
	invoice_id BIGSERIAL NOT NULL, 
	order_id BIGINT NOT NULL, 
	request_id BIGINT NOT NULL, 
	invoice_no VARCHAR(50) NOT NULL, 
	invoice_code VARCHAR(50) NOT NULL, 
	invoice_url VARCHAR(500), 
	issue_time TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	CONSTRAINT pk_ord_order_invoice PRIMARY KEY (invoice_id), 
	CONSTRAINT fk_ord_order_invoice_order_id_ord_order_main FOREIGN KEY(order_id) REFERENCES ord_order_main (order_id), 
	CONSTRAINT fk_ord_order_invoice_request_id_ord_invoice_request FOREIGN KEY(request_id) REFERENCES ord_invoice_request (request_id), 
	CONSTRAINT uq_ord_order_invoice_invoice_no UNIQUE (invoice_no)
);

CREATE TABLE ord_refund (
	refund_id BIGSERIAL NOT NULL, 
	refund_no VARCHAR(32) NOT NULL, 
	order_id BIGINT NOT NULL, 
	item_id BIGINT, 
	user_id BIGINT NOT NULL, 
	refund_type SMALLINT NOT NULL, 
	refund_amount NUMERIC(10, 2) NOT NULL, 
	refund_quantity SMALLINT NOT NULL, 
	refund_reason VARCHAR(500) NOT NULL, 
	refund_desc TEXT, 
	refund_images TEXT, 
	refund_status SMALLINT NOT NULL, 
	approve_user_id BIGINT, 
	approve_remark VARCHAR(500), 
	apply_time TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	approve_time TIMESTAMP WITHOUT TIME ZONE, 
	refund_time TIMESTAMP WITHOUT TIME ZONE, 
	complete_time TIMESTAMP WITHOUT TIME ZONE, 
	created_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	CONSTRAINT pk_ord_refund PRIMARY KEY (refund_id), 
	CONSTRAINT uq_ord_refund_refund_no UNIQUE (refund_no), 
	CONSTRAINT fk_ord_refund_order_id_ord_order_main FOREIGN KEY(order_id) REFERENCES ord_order_main (order_id), 
	CONSTRAINT fk_ord_refund_item_id_ord_order_item FOREIGN KEY(item_id) REFERENCES ord_order_item (item_id)
);

CREATE TABLE pay_payment_callback (
	callback_id BIGSERIAL NOT NULL, 
	payment_id BIGINT, 
	callback_type SMALLINT NOT NULL, 
	channel_code VARCHAR(50) NOT NULL, 
	callback_data TEXT NOT NULL, 
	handle_status SMALLINT NOT NULL, 
	handle_times SMALLINT NOT NULL, 
	sign_verify SMALLINT NOT NULL, 
	callback_time TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	handle_time TIMESTAMP WITHOUT TIME ZONE, 
	error_msg VARCHAR(500), 
	created_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	CONSTRAINT pk_pay_payment_callback PRIMARY KEY (callback_id), 
	CONSTRAINT fk_pay_payment_callback_payment_id_pay_payment_order FOREIGN KEY(payment_id) REFERENCES pay_payment_order (payment_id)
);

CREATE TABLE pay_payment_flow (
	flow_id BIGSERIAL NOT NULL, 
	flow_no VARCHAR(32) NOT NULL, 
	payment_id BIGINT NOT NULL, 
	flow_type SMALLINT NOT NULL, 
	flow_amount NUMERIC(12, 2) NOT NULL, 
	channel_flow_no VARCHAR(64), 
	channel_request TEXT, 
	channel_response TEXT, 
	flow_status SMALLINT NOT NULL, 
	error_code VARCHAR(50), 
	error_msg VARCHAR(500), 
	created_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	CONSTRAINT pk_pay_payment_flow PRIMARY KEY (flow_id), 
	CONSTRAINT uq_pay_payment_flow_flow_no UNIQUE (flow_no), 
	CONSTRAINT fk_pay_payment_flow_payment_id_pay_payment_order FOREIGN KEY(payment_id) REFERENCES pay_payment_order (payment_id)
);

CREATE TABLE pay_refund_flow (
	refund_flow_id BIGSERIAL NOT NULL, 
	refund_no VARCHAR(32) NOT NULL, 
	payment_id BIGINT NOT NULL, 
	business_refund_no VARCHAR(32) NOT NULL, 
	refund_amount NUMERIC(12, 2) NOT NULL, 
	actual_refund_amount NUMERIC(12, 2) NOT NULL, 
	channel_refund_no VARCHAR(64), 
	refund_status SMALLINT NOT NULL, 
	refund_request_time TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	refund_success_time TIMESTAMP WITHOUT TIME ZONE, 
	refund_reason VARCHAR(500), 
	created_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	CONSTRAINT pk_pay_refund_flow PRIMARY KEY (refund_flow_id), 
	CONSTRAINT uq_pay_refund_flow_refund_no UNIQUE (refund_no), 
	CONSTRAINT fk_pay_refund_flow_payment_id_pay_payment_order FOREIGN KEY(payment_id) REFERENCES pay_payment_order (payment_id)
);

CREATE TABLE afs_ticket (
	ticket_id BIGSERIAL NOT NULL, 
	ticket_no VARCHAR(32) NOT NULL, 
	user_id BIGINT NOT NULL, 
	order_id BIGINT, 
	refund_id BIGINT, 
	ticket_type SMALLINT NOT NULL, 
	ticket_category VARCHAR(100) NOT NULL, 
	ticket_title VARCHAR(200) NOT NULL, 
	ticket_desc TEXT NOT NULL, 
	ticket_images TEXT, 
	priority_level SMALLINT NOT NULL, 
	ticket_status SMALLINT NOT NULL, 
	assigned_agent_id BIGINT, 
	assigned_time TIMESTAMP WITHOUT TIME ZONE, 
	first_response_time TIMESTAMP WITHOUT TIME ZONE, 
	resolve_time TIMESTAMP WITHOUT TIME ZONE, 
	solution_desc TEXT, 
	internal_note TEXT, 
	satisfaction_score SMALLINT, 
	satisfaction_comment VARCHAR(500), 
	sla_first_response_deadline TIMESTAMP WITHOUT TIME ZONE, 
	sla_resolution_deadline TIMESTAMP WITHOUT TIME ZONE, 
	sla_breached SMALLINT NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	CONSTRAINT pk_afs_ticket PRIMARY KEY (ticket_id), 
	CONSTRAINT uq_afs_ticket_ticket_no UNIQUE (ticket_no), 
	CONSTRAINT fk_afs_ticket_order_id_ord_order_main FOREIGN KEY(order_id) REFERENCES ord_order_main (order_id), 
	CONSTRAINT fk_afs_ticket_refund_id_ord_refund FOREIGN KEY(refund_id) REFERENCES ord_refund (refund_id)
);

CREATE TABLE log_return_shipping (
	return_shipping_id BIGSERIAL NOT NULL, 
	refund_id BIGINT NOT NULL, 
	logistics_company_id BIGINT NOT NULL, 
	return_tracking_no VARCHAR(50) NOT NULL, 
	sender_name VARCHAR(50) NOT NULL, 
	sender_phone VARCHAR(20) NOT NULL, 
	sender_address VARCHAR(500) NOT NULL, 
	return_warehouse_id BIGINT, 
	return_address VARCHAR(500) NOT NULL, 
	return_status SMALLINT NOT NULL, 
	ship_time TIMESTAMP WITHOUT TIME ZONE, 
	receive_time TIMESTAMP WITHOUT TIME ZONE, 
	created_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	CONSTRAINT pk_log_return_shipping PRIMARY KEY (return_shipping_id), 
	CONSTRAINT fk_log_return_shipping_refund_id_ord_refund FOREIGN KEY(refund_id) REFERENCES ord_refund (refund_id), 
	CONSTRAINT fk_log_return_shipping_logistics_company_id_log_logisti_7f4f FOREIGN KEY(logistics_company_id) REFERENCES log_logistics_company (company_id), 
	CONSTRAINT fk_log_return_shipping_return_warehouse_id_log_warehouse FOREIGN KEY(return_warehouse_id) REFERENCES log_warehouse (warehouse_id)
);

CREATE TABLE ord_aftersales_dispute (
	dispute_id BIGSERIAL NOT NULL, 
	refund_id BIGINT NOT NULL, 
	user_id BIGINT NOT NULL, 
	dispute_reason VARCHAR(500) NOT NULL, 
	dispute_desc TEXT, 
	dispute_images TEXT, 
	dispute_status SMALLINT NOT NULL, 
	handler_id BIGINT, 
	handle_result TEXT, 
	dispute_time TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	handle_time TIMESTAMP WITHOUT TIME ZONE, 
	created_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	CONSTRAINT pk_ord_aftersales_dispute PRIMARY KEY (dispute_id), 
	CONSTRAINT fk_ord_aftersales_dispute_refund_id_ord_refund FOREIGN KEY(refund_id) REFERENCES ord_refund (refund_id)
);

CREATE TABLE ord_aftersales_evaluation (
	evaluation_id BIGSERIAL NOT NULL, 
	refund_id BIGINT NOT NULL, 
	user_id BIGINT NOT NULL, 
	service_score SMALLINT NOT NULL, 
	process_score SMALLINT NOT NULL, 
	speed_score SMALLINT NOT NULL, 
	evaluation_content TEXT, 
	evaluation_status SMALLINT NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	CONSTRAINT pk_ord_aftersales_evaluation PRIMARY KEY (evaluation_id), 
	CONSTRAINT fk_ord_aftersales_evaluation_refund_id_ord_refund FOREIGN KEY(refund_id) REFERENCES ord_refund (refund_id)
);

CREATE TABLE ord_aftersales_log (
	log_id BIGSERIAL NOT NULL, 
	refund_id BIGINT NOT NULL, 
	operation_type SMALLINT NOT NULL, 
	operation_desc VARCHAR(500) NOT NULL, 
	operator_id BIGINT, 
	operator_type SMALLINT NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	CONSTRAINT pk_ord_aftersales_log PRIMARY KEY (log_id), 
	CONSTRAINT fk_ord_aftersales_log_refund_id_ord_refund FOREIGN KEY(refund_id) REFERENCES ord_refund (refund_id)
);

CREATE TABLE afs_quality (
	quality_id BIGSERIAL NOT NULL, 
	ticket_id BIGINT NOT NULL, 
	agent_id BIGINT NOT NULL, 
	inspector_id BIGINT NOT NULL, 
	quality_date TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	response_time_score SMALLINT NOT NULL, 
	service_attitude_score SMALLINT NOT NULL, 
	professional_score SMALLINT NOT NULL, 
	problem_solving_score SMALLINT NOT NULL, 
	communication_score SMALLINT NOT NULL, 
	total_score SMALLINT NOT NULL, 
	quality_result SMALLINT NOT NULL, 
	problem_desc TEXT, 
	improvement_advice TEXT, 
	need_retraining SMALLINT NOT NULL, 
	quality_type SMALLINT NOT NULL, 
	remark VARCHAR(500), 
	created_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	CONSTRAINT pk_afs_quality PRIMARY KEY (quality_id), 
	CONSTRAINT fk_afs_quality_ticket_id_afs_ticket FOREIGN KEY(ticket_id) REFERENCES afs_ticket (ticket_id)
);

